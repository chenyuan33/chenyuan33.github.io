<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>排序算法可视化 - cy3's site</title>
	<link rel="stylesheet" type="text/css" href="/csses.css" />
	<script src="/jses.js"></script>
	<style>
		#visu-box {
			height: 100px;
			background-color: black;
			border: solid;
		}

		.element-of-visu {
			display: inline-block;
		}
	</style>
	<script>
		let curArray = [], algoList = ['bubbleSort', 'selectionSort', 'insertionSort', 'gnomeSort', 'cocktailSort', 'shellSort'], genInc = () => {
			let n = document.getElementById('array-size').value, x = document.getElementById('many-duplicated').checked, ret = [];
			for (let i = 0; i < n; i++) {
				ret.push(x ? Math.floor(i / Math.sqrt(n)) + 1 : i + 1);
			}
			return ret;
		}, displayArray = () => {
			document.getElementById('visu-box').innerHTML = "";
			for (let i = 0; i < curArray.length; i++) {
				let cur = document.createElement('div');
				cur.classList = 'element-of-visu';
				cur.style.height = curArray[i].num / Math.max.apply(null, curArray.map(v => v.num)) * 100 + '%';
				cur.style.width = 100 / curArray.length + '%';
				cur.style.backgroundColor = curArray[i].color;
				document.getElementById('visu-box').appendChild(cur);
			}
		}, whiteArrayDisplay = arr => {
			curArray = [];
			for (let i = 0; i < arr.length; i++) {
				curArray.push({ num: arr[i], color: "white" });
			}
			displayArray();
		}, makeRand = () => {
			let arr = genInc();
			randomShuffle(arr);
			whiteArrayDisplay(arr);
		}, makeInc = () => {
			whiteArrayDisplay(genInc());
		}, makeDec = () => {
			let arr = genInc();
			arr.reverse();
			whiteArrayDisplay(arr);
		}, doEnable = () => {
			document.getElementById('arrayRemaker1').disabled = false;
			document.getElementById('arrayRemaker2').disabled = false;
			document.getElementById('arrayRemaker3').disabled = false;
			algoList.forEach(name => {
				document.getElementById(name + 'Button').classList = 'buttonInTable';
				document.getElementById(name + 'Button').onclick = eval(name);
			});
		}, doDisable = () => {
			document.getElementById('arrayRemaker1').disabled = true;
			document.getElementById('arrayRemaker2').disabled = true;
			document.getElementById('arrayRemaker3').disabled = true;
			algoList.forEach(name => {
				document.getElementById(name + 'Button').classList = 'disabledButtonInTable';
				document.getElementById(name + 'Button').onclick = 'void(0)';
			});
		};
		async function bubbleSort() {
			doDisable();
			for (let i = curArray.length - 1; i >= 0; i--) {
				for (let j = 0; j < i; j++) {
					curArray[j].color = 'red';
					curArray[j + 1].color = 'red';
					displayArray();
					await sleep(document.getElementById('delay').value);
					if (curArray[j].num > curArray[j + 1].num) {
						[curArray[j].num, curArray[j + 1].num] = [curArray[j + 1].num, curArray[j].num];
					}
					curArray[j].color = 'white';
					curArray[j + 1].color = 'white';
				}
				curArray[i].color = 'green';
			}
			displayArray();
			doEnable();
		};
		async function selectionSort() {
			doDisable();
			for (let i = 0; i < curArray.length; i++) {
				let maxx = i;
				for (let j = i; j < curArray.length; j++) {
					curArray[j].color = 'blue';
					curArray[maxx].color = 'red';
					displayArray();
					await sleep(document.getElementById('delay').value);
					curArray[j].color = 'white';
					curArray[maxx].color = 'white';
					if (curArray[j].num < curArray[maxx].num) {
						maxx = j;
					}
				}
				[curArray[i].num, curArray[maxx].num] = [curArray[maxx].num, curArray[i].num];
				curArray[i].color = 'green';
			}
			displayArray();
			doEnable();
		}
		async function insertionSort() {
			doDisable();
			for (let i = 0; i < curArray.length; i++) {
				curArray[i].color = 'red';
				for (let j = i; j >= 0; j--) {
					displayArray();
					await sleep(document.getElementById('delay').value);
					if (j > 0 && curArray[j].num < curArray[j - 1].num) {
						[curArray[j], curArray[j - 1]] = [curArray[j - 1], curArray[j]];
					}
					else {
						curArray[j].color = 'green';
						break;
					}
				}
			}
			displayArray();
			doEnable();
		}
		async function gnomeSort() {
			doDisable();
			for (let i = 0; i < curArray.length;) {
				curArray[i].color = 'red';
				displayArray();
				await sleep(document.getElementById('delay').value);
				if (i > 0 && curArray[i].num < curArray[i - 1].num) {
					[curArray[i], curArray[i - 1]] = [curArray[i - 1], curArray[i]];
					i--;
				}
				else {
					curArray[i].color = 'green';
					i++;
				}
			}
			displayArray();
			doEnable();
		}
		async function cocktailSort() {
			doDisable();
			for (let l = 0, r = curArray.length - 1; l < r; l++, r--) {
				for (let j = l; j < r; j++) {
					curArray[j].color = 'red';
					curArray[j + 1].color = 'red';
					displayArray();
					await sleep(document.getElementById('delay').value);
					if (curArray[j].num > curArray[j + 1].num) {
						[curArray[j].num, curArray[j + 1].num] = [curArray[j + 1].num, curArray[j].num];
					}
					curArray[j].color = 'white';
					curArray[j + 1].color = 'white';
				}
				curArray[r].color = 'green';
				for (let j = r - 2; j >= l; j--) {
					curArray[j].color = 'red';
					curArray[j + 1].color = 'red';
					displayArray();
					await sleep(document.getElementById('delay').value);
					if (curArray[j].num > curArray[j + 1].num) {
						[curArray[j].num, curArray[j + 1].num] = [curArray[j + 1].num, curArray[j].num];
					}
					curArray[j].color = 'white';
					curArray[j + 1].color = 'white';
				}
				curArray[l].color = 'green';
			}
			displayArray();
			doEnable();
		}
		async function shellSort() {
			doDisable();
			let flag = false;
			for (let k = Math.floor(curArray.length / 2); k >= 1; k = Math.floor(k / 2)) {
				displayArray();
				await sleep(document.getElementById('delay').value);
				for (let i = 0; i < curArray.length; i++) {
					for (let j = 0; j < curArray.length; j++) {
						if (j % k == i % k) {
							if (j < i) {
								curArray[j].color = 'green';
							}
							else if (j == i) {
								curArray[j].color = 'red';
							}
							else {
								curArray[j].color = 'blue';
							}
						}
						else {
							curArray[j].color = 'white';
						}
					}
					for (let j = i; j >= 0; j -= k) {
						displayArray();
						await sleep(document.getElementById('delay').value);
						if (j >= k && curArray[j].num < curArray[j - k].num) {
							[curArray[j], curArray[j - k]] = [curArray[j - k], curArray[j]];
						}
						else {
							curArray[j].color = 'green';
							break;
						}
					}
				}
			}
			displayArray();
			doEnable();
		};
	</script>
</head>

<body>
	<h1>排序算法可视化</h1>
	<p>算法流程可参考<a href="https://www.luogu.com.cn/article/n6pxq6h7">这篇文章</a>。</p>
	<div id="visu-box"></div>
	<h2>重新创建数组</h2>
	<label for="array-size">数组大小（过大会导致性能问题和可视化时间过长）：</label>
	<input type="number" id="array-size" value="20" min="1">
	<br>
	<input type="checkbox" id="many-duplicated">
	<label for="many-duplicated">创建的数组中是否含有大量重复元素</label>
	<br>
	<button id="arrayRemaker1" onclick="makeRand()">创建随机数组</button>
	<button id="arrayRemaker2" onclick="makeInc()">创建升序数组</button>
	<button id="arrayRemaker3" onclick="makeDec()">创建降序数组</button>
	<script>
		makeRand();
	</script>
	<h2>设置</h2>
	<label for="delay">每一帧的时间间隔（单位：毫秒）</label>
	<input type="number" id="delay" value="10">
	<h2>排序</h2>
	<table id="algo-table">
		<tr>
			<th>算法名称</th>
			<th>启动</th>
			<th>时间复杂度</th>
			<th>是否稳定</th>
		</tr>
		<tr>
			<td>冒泡排序</td>
			<td onclick="bubbleSort()" class="buttonInTable" id="bubbleSortButton">启动</td>
			<td rowspan="6">\[O(n^2)\]</td>
			<td>是</td>
		</tr>
		<tr>
			<td>选择排序</td>
			<td onclick="selectionSort()" class="buttonInTable" id="selectionSortButton">启动</td>
			<td>否</td>
		</tr>
		<tr>
			<td>插入排序</td>
			<td onclick="insertionSort()" class="buttonInTable" id="insertionSortButton">启动</td>
			<td>是</td>
		</tr>
		<tr>
			<td>地精排序</td>
			<td onclick="gnomeSort()" class="buttonInTable" id="gnomeSortButton">启动</td>
			<td>是</td>
		</tr>
		<tr>
			<td>鸡尾酒排序</td>
			<td onclick="cocktailSort()" class="buttonInTable" id="cocktailSortButton">启动</td>
			<td>是</td>
		</tr>
		<tr>
			<td>希尔排序</td>
			<td onclick="shellSort()" class="buttonInTable" id="shellSortButton">启动</td>
			<td>否</td>
		</tr>
	</table>
	<h2>未完成的排序算法：</h2>
	<ul>
		<li>时间复杂度 \(O(n\log n)\)：锦标赛排序，归并排序，堆排序，快速排序，桶排序，多路归并排序，内省排序，tim 排序，模式破坏快速排序 (pdqsort)。</li>
		<li>不基于比较：珠排序，计数排序，基数排序。</li>
		<li>便于并行计算：奇偶排序，双调排序。</li>
		<li>乱搞：猴子排序，蠢猴排序，全排列排序，慢速排序，臭皮匠排序，睡眠排序。</li>
	</ul>
	<script>scripts()</script>
</body>

</html>